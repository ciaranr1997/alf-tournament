<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Panel - Matches</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1f2937; color: #f9fafb; }
        .card { background-color: #374151; padding: 2rem; border-radius: 0.5rem; }
        input, select { background-color: #4B5563; color: #F9FAFB; }
    </style>
</head>
<body>
    <div class="container mx-auto p-4">
        <div class="card">
            <h1 class="text-2xl font-bold mb-4">Create Matchup</h1>
            <form id="createMatchupForm" class="mt-4">
                <div class="mb-4">
                    <label for="team1" class="block mb-2">Team 1</label>
                    <select class="w-full p-2 rounded" id="team1" required></select>
                </div>
                <div class="mb-4">
                    <label for="team2" class="block mb-2">Team 2</label>
                    <select class="w-full p-2 rounded" id="team2" required></select>
                </div>
                <div class="mb-4">
                    <label for="bestOf" class="block mb-2">Best Of</label>
                    <select class="w-full p-2 rounded" id="bestOf" required>
                        <option>3</option>
                        <option>5</option>
                        <option>7</option>
                        <option>9</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="round" class="block mb-2">Round</label>
                    <select class="w-full p-2 rounded" id="round" required>
                        <option>Round 1</option>
                        <option>Quarterfinals</option>
                        <option>Semifinals</option>
                        <option>Finals</option>
                    </select>
                </div>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Create Matchup</button>
            </form>

            <hr class="my-6 border-gray-600">

            <h2 class="text-2xl font-bold mb-4">Existing Matchups</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr>
                            <th class="py-2 px-4 border-b border-gray-600 text-left">Round</th>
                            <th class="py-2 px-4 border-b border-gray-600 text-left">Team 1</th>
                            <th class="py-2 px-4 border-b border-gray-600 text-left">Team 2</th>
                            <th class="py-2 px-4 border-b border-gray-600 text-left">Best Of</th>
                            <th class="py-2 px-4 border-b border-gray-600 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="matchupsTable">
                        <!-- Matchups will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="/js/jquery-3.7.1.min.js"></script>
    <script>
        function loadMatchups() {
            $.get("/api/matchups", function(matchups) {
                const matchupsTable = $("#matchupsTable");
                matchupsTable.empty(); // Clear existing rows
                matchups.forEach(matchup => {
                    const row = `
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-600">${matchup.round_name}</td>
                            <td class="py-2 px-4 border-b border-gray-600">${matchup.team1_name}</td>
                            <td class="py-2 px-4 border-b border-gray-600">${matchup.team2_name}</td>
                            <td class="py-2 px-4 border-b border-gray-600">${matchup.format}</td>
                            <td class="py-2 px-4 border-b border-gray-600">
                                <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 px-2 rounded text-sm start-pick-ban" data-id="${matchup.match_id}">Picks/Bans</button>
                                <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-2 rounded text-sm delete-matchup" data-id="${matchup.match_id}">Delete</button>
                            </td>
                        </tr>
                    `;
                    matchupsTable.append(row);
                });
            });
        }

        $(document).ready(function() {
            // Fetch teams and populate dropdowns
            $.get("/api/teams", function(teams) {
                const team1Select = $("#team1");
                const team2Select = $("#team2");
                teams.forEach(team => {
                    team1Select.append(`<option value="${team.id}">${team.name}</option>`);
                    team2Select.append(`<option value="${team.id}">${team.name}</option>`);
                });
            });

            loadMatchups(); // Load matchups on page load

            // Handle form submission
            $("#createMatchupForm").submit(function(event) {
                event.preventDefault();
                const matchup = {
                    team1: $("#team1").val(),
                    team2: $("#team2").val(),
                    bestOf: $("#bestOf").val(),
                    round: $("#round").val()
                };

                $.post("/api/matchups", matchup, function(data) {
                    // For now, just log the response
                    console.log(data);
                    loadMatchups(); // Refresh the matchups table
                });
            });

            // Handle delete button click
            $("#matchupsTable").on("click", ".delete-matchup", function() {
                const matchId = $(this).data("id");
                if (confirm("Are you sure you want to delete this matchup?")) {
                    $.ajax({
                        url: "/api/matchups/" + matchId,
                        type: "DELETE",
                        success: function(result) {
                            console.log(result);
                            loadMatchups(); // Refresh the matchups table
                        }
                    });
                }
            });

            // Handle "Picks/Bans" button click
            $("#matchupsTable").on("click", ".start-pick-ban", function() {
                const matchId = $(this).data("id");
                if (confirm("Are you sure you want to start the pick/ban process for this match?")) {
                    $.ajax({
                        url: "/api/matches/" + matchId + "/start-pick-ban",
                        type: "POST",
                        success: function(result) {
                            console.log(result);
                            alert(result.message);
                        },
                        error: function(xhr, status, error) {
                            console.error("Error starting pick/ban:", error);
                            alert("Error: " + xhr.responseJSON.message);
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
